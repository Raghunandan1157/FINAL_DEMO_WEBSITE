<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NLPL / NMSPL ‚Äì Org Select + Login + Directory</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ‚úÖ CHATBASE EMBED (replace id with your real Chatbase widget id) -->
  <script src="https://www.chatbase.co/embed.min.js" id="YOUR_CHATBASE_ID"></script>

  <style>
    :root{
      --bg:#ffffff; --frame:#ffffff; --ink:#0f172a; --muted:#6b7280; --line:rgba(17,24,39,.08);
      --accent:#e46357; --accent-2:#e9786f;
      --indigo-1:#6366f1; --indigo-2:#8b5cf6;
      --glow-1:#f472b6; --glow-2:#60a5fa; --glow-3:#34d399;
    }

    html,body{height:100%}
    body{
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial;
      color:var(--ink);
      background:var(--bg);
      overflow-x:hidden;
    }

    /* ---------- Decorative backgrounds (no logic change) ---------- */
    #viewOrgChoice, #viewLogin{
      position:relative;
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(99,102,241,.08), transparent 60%),
        radial-gradient(1000px 700px at 120% 120%, rgba(233,99,87,.06), transparent 60%),
        radial-gradient(circle at 1px 1px, rgba(15,23,42,.06) 1px, transparent 0) 0 0/24px 24px,
        var(--bg);
    }
    #viewOrgChoice::before, #viewLogin::before{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background:
        linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.35));
      mask:linear-gradient(180deg, rgba(0,0,0,.6), transparent 60%);
    }

    /* ---------- GENERAL CARDS / BUTTONS ---------- */
    .frame{
      border:6px solid var(--frame);
      border-radius:28px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.78));
      overflow:hidden;
      position:relative;
      box-shadow:
        0 20px 60px rgba(2, 8, 23, .08),
        inset 0 1px 0 rgba(255,255,255,.5);
      backdrop-filter:saturate(1.2) blur(10px);
      animation:cardPulse 10s ease-in-out infinite;
    }
    .frame::before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius:inherit;
      background:conic-gradient(from 90deg, rgba(99,102,241,.35), rgba(236,72,153,.35), rgba(99,102,241,.35));
      opacity:.45;
      filter:blur(18px);
      z-index:-1;
      animation:borderGlow 12s linear infinite;
    }
    .logo{width:min(72%,360px); height:auto; object-fit:contain}

    .input{
      appearance:none;width:100%;
      border-radius:12px;border:1px solid #e5e7eb;background:#fff;
      padding:.75rem .9rem;outline:none;
      transition:border-color .2s,box-shadow .2s, transform .06s ease;
      text-transform:uppercase; /* UX: normalize */
    }
    .input:focus{border-color:#c7d2fe;box-shadow:0 0 0 6px rgba(99,102,241,.12)}
    .input:active{transform:scale(.998)}

    .otp-grid{display:grid;grid-template-columns:repeat(var(--digits,6),1fr);gap:.6rem}
    .otp-cell{
      text-align:center;letter-spacing:.04em;font-weight:800;font-size:1.15rem;
      font-variant-numeric:tabular-nums;
      text-transform:uppercase;
    }

    @keyframes roll{0%{filter:brightness(.95)}50%{filter:brightness(1.05)}100%{filter:brightness(1)}}
    @keyframes flipIn{0%{transform:rotateX(0)}60%{transform:rotateX(360deg)}100%{transform:rotateX(360deg)}}
    .rolling{animation:roll .6s ease-in-out}
    .flip{animation:flipIn .6s ease-in-out}

    /* ---------- ORG CHOICE BIG BUTTONS ---------- */
    .org-btn{
      border-radius:22px;border:2px solid rgba(15,23,42,.06);background:#fff;
      padding:28px;
      box-shadow:0 24px 60px rgba(2, 8, 23, .08);
      transition:transform .15s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
      position:relative; isolation:isolate;
      overflow:hidden;
    }
    .org-btn::after{
      content:""; position:absolute; inset:0; border-radius:20px; z-index:-1;
      background:linear-gradient(135deg, rgba(99,102,241,.12), rgba(233,99,87,.10));
      opacity:.0; transition:opacity .2s ease;
    }
    .org-btn::before{
      content:""; position:absolute; inset:-2px; border-radius:24px; z-index:-2;
      background:conic-gradient(from 0deg, rgba(96,165,250,.35), rgba(244,114,182,.45), rgba(129,140,248,.4));
      opacity:.7; filter:blur(25px);
      animation:gradientOrbit 6s linear infinite;
    }
    .org-btn:hover{
      transform:translateY(-2px);
      box-shadow:0 28px 70px rgba(2, 8, 23, .12);
      border-color:rgba(99,102,241,.35);
    }
    .org-btn:hover::after{opacity:1}
    .org-title{font-size:clamp(22px,4vw,40px);font-weight:900;letter-spacing:.01em}
    .org-sub{color:#6b7280}

    /* ---------- DIRECTORY THEME (dark) ---------- */
    .dir-wrap{
      min-height:100vh;
      background:
        radial-gradient(1200px 800px at -10% -10%, rgba(99,102,241,.18), transparent 55%),
        radial-gradient(1000px 700px at 110% 120%, rgba(8,145,178,.18), transparent 55%),
        #0b1020;
      color:#e6ebff;
    }
    #linkContainer{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(260px,1fr));
      gap:14px;
    }
    .card{
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:14px;padding:16px 18px;
      display:flex;align-items:center;justify-content:space-between;
      transition:background .18s ease, transform .1s ease, border-color .18s ease;
      box-shadow:0 8px 24px rgba(0,0,0,.18);
    }
    .card:hover{background:rgba(255,255,255,0.09);transform:translateY(-2px);border-color:rgba(255,255,255,0.18);}
    .details{font-weight:600; letter-spacing:.2px}

    .button-link{
      background:linear-gradient(135deg,var(--indigo-1),var(--indigo-2));
      color:#fff;padding:10px 14px;border-radius:10px;
      text-decoration:none;font-weight:600;white-space:nowrap;
      box-shadow:0 0 0 0 rgba(139,92,246,.0);
      transition:transform .1s ease, box-shadow .15s ease, filter .15s ease;
    }
    .button-link:hover{transform:translateY(-1px); filter:brightness(1.05); box-shadow:0 6px 18px rgba(139,92,246,.35);}

    /* ---------- Name Suggest dropdown ---------- */
    #nameSuggest{
      background:rgba(255,255,255,.9);
      backdrop-filter:saturate(1.2) blur(8px);
      border-radius:14px;
      border:1px solid rgba(15,23,42,.08);
      box-shadow:0 18px 45px rgba(2,8,23,.12);
      overflow:auto;
      max-height: 320px;
    }
    #nameSuggest > div{transition:background .12s ease}
    #nameSuggest > div:hover{background:rgba(99,102,241,.09)}

    /* ---------- Status text ---------- */
    #status{min-height:1.25rem}

    /* ---------- Buttons (CTA) ---------- */
    .cta{
      display:inline-flex; align-items:center; justify-content:center;
      border-radius:999px; padding:.9rem 1.1rem; font-weight:700; color:#fff;
      box-shadow:0 10px 24px rgba(233,99,87,.25);
      transition:transform .1s ease, filter .15s ease, box-shadow .15s ease;
      position:relative;
      overflow:hidden;
    }
    .cta::after{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(120deg,rgba(255,255,255,.4),rgba(255,255,255,0));
      transform:translateX(-120%);
      animation:ctaShine 4s ease-in-out infinite;
    }
    .cta:hover{transform:translateY(-1px); filter:brightness(1.02);}
    .cta:active{transform:translateY(0);}

    /* ---------- Ambient d√©cor ---------- */
    #viewOrgChoice > main,
    #viewLogin > main{position:relative; z-index:1;}
    .hero-ambient,
    .login-ambient{
      position:absolute;
      inset:-10% -5%;
      pointer-events:none;
      z-index:0;
    }
    .hero-ambient span,
    .login-ambient span{
      position:absolute;
      width:220px;
      height:220px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 30%, rgba(96,165,250,.25), transparent 60%);
      filter:blur(0px);
      opacity:.8;
      top:var(--y,20%);
      left:var(--x,20%);
      animation:floatDrift var(--time,14s) ease-in-out infinite;
      animation-delay:var(--delay,0s);
    }
    .hero-ambient span:nth-child(2){background:radial-gradient(circle at 60% 30%, rgba(244,114,182,.25), transparent 60%);}
    .hero-ambient span:nth-child(3){background:radial-gradient(circle at 50% 50%, rgba(52,211,153,.25), transparent 65%);}
    .hero-badges{
      display:flex; justify-content:center; gap:.75rem; flex-wrap:wrap;
      margin-top:1.75rem;
    }
    .hero-badges span{
      font-size:.7rem; letter-spacing:.12em; text-transform:uppercase;
      border:1px solid rgba(15,23,42,.08); border-radius:999px;
      padding:.4rem .95rem;
      color:var(--muted);
      background:rgba(255,255,255,.85);
      box-shadow:0 12px 25px rgba(15,23,42,.06);
      animation:badgePulse 5s ease-in-out infinite;
    }
    .hero-badges span:nth-child(2){animation-delay:.3s}
    .hero-badges span:nth-child(3){animation-delay:.6s}

    .login-pills{
      display:flex; flex-wrap:wrap; gap:.5rem; margin-top:.25rem;
    }
    .login-pills span{
      font-size:.68rem; letter-spacing:.08em; text-transform:uppercase;
      padding:.3rem .85rem;
      border-radius:999px;
      border:1px solid rgba(99,102,241,.18);
      background:rgba(255,255,255,.9);
      color:#4c1d95;
      animation:badgePulse 4.2s ease-in-out infinite;
    }
    .login-pills span:nth-child(2){animation-delay:.2s}
    .login-pills span:nth-child(3){animation-delay:.4s}

    /* ---------- Animations ---------- */
    @keyframes floatDrift{
      0%{transform:translate3d(0,0,0) scale(.8); opacity:.4;}
      50%{transform:translate3d(30px,-40px,0) scale(1.05); opacity:.75;}
      100%{transform:translate3d(-10px,10px,0) scale(.8); opacity:.4;}
    }
    @keyframes gradientOrbit{
      0%{transform:rotate(0deg);}
      100%{transform:rotate(360deg);}
    }
    @keyframes cardPulse{
      0%,100%{box-shadow:0 20px 60px rgba(2,8,23,.10);}
      50%{box-shadow:0 25px 70px rgba(2,8,23,.18);}
    }
    @keyframes borderGlow{
      0%{opacity:.4;}
      50%{opacity:.8;}
      100%{opacity:.4;}
    }
    @keyframes badgePulse{
      0%,100%{transform:translateY(0); box-shadow:0 8px 18px rgba(99,102,241,.12);}
      50%{transform:translateY(-6px); box-shadow:0 18px 25px rgba(244,114,182,.18);}
    }
    @keyframes ctaShine{
      0%{transform:translateX(-120%);}
      40%{transform:translateX(120%);}
      100%{transform:translateX(120%);}
    }

    @media (prefers-reduced-motion: reduce){
      .hero-ambient span,
      .login-ambient span,
      .hero-badges span,
      .login-pills span,
      .frame,
      .cta::after,
      .org-btn::before{animation:none !important;}
    }

    /* ---------- Small tweaks for mobile spacing ---------- */
    @media (max-width: 1024px){
      #viewOrgChoice main{padding-inline:clamp(1.25rem,4vw,2rem);}
      #viewOrgChoice .grid{gap:1.25rem;}
      .org-btn{padding:22px;}
      .org-btn .org-title{font-size:clamp(20px,3vw,36px);}
      #viewDirectory .max-w-4xl{padding-inline:clamp(1rem,6vw,2.5rem);}
    }

    @media (max-width: 640px){
      .frame{border-width:4px;border-radius:22px}
      .otp-cell{font-size:1.05rem}
      #viewOrgChoice header{padding-inline:1rem;}
      #viewOrgChoice h1{font-size:clamp(1.75rem,6vw,2.5rem);}
      #viewLogin .frame{padding:0;}
      #viewDirectory .max-w-4xl{padding-inline:1rem;}
    }
  </style>
</head>
<body>

  <!-- ============= VIEW: ORGANIZATION CHOICE ============= -->
  <section id="viewOrgChoice" class="min-h-screen flex items-center justify-center p-6">
    <div class="hero-ambient" aria-hidden="true">
      <span style="--x:8%;--y:15%;--time:18s;"></span>
      <span style="--x:70%;--y:10%;--time:20s;--delay:.6s;"></span>
      <span style="--x:55%;--y:65%;--time:15s;--delay:1.2s;"></span>
      <span style="--x:15%;--y:70%;--time:22s;--delay:.9s;"></span>
    </div>
    <main class="w-full max-w-5xl">
      <header class="text-center mb-10">
        <h1 class="text-3xl sm:text-4xl font-black text-green-600 tracking-tight">SELECT YOUR ENTITY</h1>
        <p class="text-[var(--muted)] mt-2">Pick where you want to go. We‚Äôll tailor the login and links accordingly.</p>
        <div class="hero-badges" aria-hidden="true">
          <span>Single Sign-on</span>
          <span>Realtime Directory</span>
          <span>Launchpad Access</span>
        </div>
      </header>

      <div class="grid sm:grid-cols-2 gap-6">
        <!-- NMSPL -->
        <button id="btnChooseNMSPL" class="org-btn text-left">
          <div class="flex items-center gap-4">
            <div class="h-14 w-14 rounded-xl bg-indigo-50 flex items-center justify-center">
              <span class="text-2xl">üè¢</span>
            </div>
            <div>
              <div class="org-title text-indigo-600">NMSPL</div>
              <div class="org-sub">Go to NMSPL branch location (password login)</div>
            </div>
          </div>
        </button>

        <!-- NLPL -->
        <a href="./nlpl.html" class="org-btn text-left block">
          <div class="flex items-center gap-4">
            <div class="h-14 w-14 rounded-xl bg-rose-50 flex items-center justify-center">
              <span class="text-2xl">üåê</span>
            </div>
            <div>
              <div class="org-title text-rose-600">NLPL</div>
              <div class="org-sub">Open the full directory (no password)</div>
            </div>
          </div>
        </a>
      </div>
    </main>
  </section>

  <!-- ============= VIEW: LOGIN (Shared Shell) ============= -->
  <section id="viewLogin" class="min-h-screen hidden flex items-center justify-center p-4 sm:p-6">
    <div class="login-ambient" aria-hidden="true">
      <span style="--x:12%;--y:20%;--time:18s;"></span>
      <span style="--x:80%;--y:15%;--time:20s;--delay:.5s;"></span>
      <span style="--x:60%;--y:75%;--time:16s;--delay:1s;"></span>
    </div>
    <main class="frame w-full max-w-6xl grid lg:grid-cols-2">
      <!-- LEFT / TOP on mobile: Logo -->
      <section class="p-6 sm:p-8 md:p-10 flex items-center justify-center order-1">
        <img id="orgLogo" src="./NLPL Logo.jpg" alt="Organization Logo" class="logo" />
      </section>

      <!-- RIGHT / BOTTOM on mobile -->
      <section class="p-5 sm:p-8 md:p-10 flex flex-col gap-6 order-2">
        <div>
          <h1 id="welcomeTitle" class="text-2xl sm:text-3xl md:text-4xl font-black leading-tight">Welcome</h1>
          <p id="welcomeSub" class="text-gray-500 mt-1">Please sign in</p>
          <div class="login-pills" aria-hidden="true">
            <span>Encrypted Flow</span>
            <span>Supabase Sync</span>
            <span>Chatbase Ready</span>
          </div>
        </div>

        <!-- ===== NMSPL Pane (username + password) ===== -->
        <div id="nmsplPane" class="grid gap-5">
          <div>
            <label class="block text-sm text-gray-500 mb-1">Username</label>
            <input id="nmsplUser" class="input" type="text" placeholder="Enter username" autocomplete="username" />
          </div>
          <div>
            <label class="block text-sm text-gray-500 mb-1">Password</label>
            <input id="nmsplPass" class="input" type="password" placeholder="Enter password" autocomplete="current-password" />
            <p class="mt-1 text-xs text-gray-400">Username: <b>NMSPL</b> / <b>Nmspl@123</b></p>
          </div>
          <button id="nmsplLoginBtn" class="cta w-full shadow-sm active:scale-[.99]"
            style="background:linear-gradient(180deg,#6366f1,#8b5cf6)">Login to NMSPL</button>
        </div>

        <div class="mt-1 text-center">
          <div id="status" class="text-sm text-gray-500"></div>
        </div>

        <div class="text-center">
          <button id="backToOrg" class="text-xs text-gray-500 hover:text-gray-700 underline">‚Üê Choose a different organization</button>
        </div>
      </section>
    </main>
  </section>

  <script>
    const CHATBASE_TOKEN_ENDPOINT = "http://localhost:3000/get-user-token";

    const viewOrgChoice = document.getElementById('viewOrgChoice');
    const viewLogin = document.getElementById('viewLogin');
    const orgLogo = document.getElementById('orgLogo');
    const welcomeTitle = document.getElementById('welcomeTitle');
    const welcomeSub = document.getElementById('welcomeSub');
    const statusEl = document.getElementById('status');
    const backToOrg = document.getElementById('backToOrg');
    const nmsplUser = document.getElementById('nmsplUser');
    const nmsplPass = document.getElementById('nmsplPass');
    const nmsplLoginBtn = document.getElementById('nmsplLoginBtn');
    const btnChooseNMSPL = document.getElementById('btnChooseNMSPL');

    btnChooseNMSPL?.addEventListener('click', showNMSPLLogin);

    backToOrg?.addEventListener('click', ()=>{
      viewLogin.classList.add('hidden');
      viewOrgChoice.classList.remove('hidden');
      statusEl.textContent='';
      statusEl.style.color='#6b7280';
      nmsplUser.value='';
      nmsplPass.value='';
    });

    function showNMSPLLogin(){
      orgLogo.src = './NMSPL logo.png';
      welcomeTitle.textContent = 'Welcome to NMSPL';
      welcomeSub.textContent = 'Please sign in with username & password';
      viewOrgChoice.classList.add('hidden');
      viewLogin.classList.remove('hidden');
      statusEl.textContent='';
      statusEl.style.color='#6b7280';
      nmsplUser.focus();
      window.scrollTo({top:0,behavior:"instant"});
    }

    async function identifyWithChatbase(attrs){
      try{
        if(typeof window.chatbase !== "function") return;
        const res = await fetch(CHATBASE_TOKEN_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(attrs)
        });
        const data = await res.json();
        if(data && data.token){
          window.chatbase("identify", { token: data.token });
          console.log("‚úÖ Chatbase identified:", attrs.user_id);
        }
      }catch(err){
        console.warn("Chatbase identify failed:", err);
      }
    }

    nmsplLoginBtn?.addEventListener('click', ()=>{
      const u = (nmsplUser.value || '').trim();
      const p = nmsplPass.value || '';
      if(u==='NMSPL' && p==='Nmspl@123'){
        statusEl.textContent = 'Login successful. Redirecting to NMSPL Branch Location‚Ä¶';
        statusEl.style.color = '#16a34a';

        identifyWithChatbase({ user_id: u, name: u, org: 'NMSPL' });

        const target = './NMSPL%20BRANCH%20LOCATION/index.html';
        setTimeout(()=>{ window.location.href = target; }, 400);
      }else{
        statusEl.textContent = 'Invalid NMSPL credentials.';
        statusEl.style.color = '#ef4444';
      }
    });
  </script>

</body>
</html>
