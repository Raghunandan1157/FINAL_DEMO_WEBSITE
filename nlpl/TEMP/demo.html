<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Supabase Test – database table</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #ffffff; /* pure white */
      color: #111827;
    }
    .container {
      max-width: 1000px;
      margin: 40px auto;
      padding: 24px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.05);
      background: #ffffff;
    }
    h1 {
      margin-top: 0;
      font-size: 1.5rem;
    }
    .status {
      padding: 8px 12px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      margin-bottom: 16px;
    }
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #9ca3af;
    }
    .status.connected .status-dot {
      background: #22c55e;
    }
    .status.error .status-dot {
      background: #ef4444;
    }
    .status-text {
      font-weight: 500;
    }
    .error-message {
      color: #b91c1c;
      background: #fee2e2;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 0.9rem;
      margin-bottom: 16px;
      display: none;
      white-space: pre-wrap;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 0.9rem;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      text-align: left;
    }
    th {
      background: #f9fafb;
      font-weight: 600;
    }
    tbody tr:nth-child(even) {
      background: #f9fafb;
    }
    .loading {
      font-size: 0.9rem;
      color: #6b7280;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Supabase Connection – <code>database</code> table</h1>

    <div id="status" class="status">
      <div class="status-dot"></div>
      <span class="status-text">Connecting…</span>
    </div>

    <div id="error" class="error-message"></div>

    <div class="loading" id="loading">Loading data from <code>database</code>…</div>
    <div id="table-container"></div>
  </div>

  <script>
    // Your Supabase credentials (anon key is OK on frontend; don't use service_role here)
    const SUPABASE_URL = "https://zovnmmdfthpbubrorsgh.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpvdm5tbWRmdGhwYnVicm9yc2doIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1NzE3ODgsImV4cCI6MjA3NzE0Nzc4OH0.92BH2sjUOgkw6iSRj1_4gt0p3eThg3QT4VK-Q4EdmBE";
    const TABLE_NAME = "database";

    const { createClient } = supabase;
    const client = createClient(SUPABASE_URL, SUPABASE_KEY);

    const statusEl = document.getElementById("status");
    const statusTextEl = statusEl.querySelector(".status-text");
    const errorEl = document.getElementById("error");
    const loadingEl = document.getElementById("loading");
    const tableContainer = document.getElementById("table-container");

    function setStatus(state, message) {
      statusEl.classList.remove("connected", "error");
      if (state) statusEl.classList.add(state);
      statusTextEl.textContent = message;
    }

    function showError(message) {
      errorEl.style.display = "block";
      errorEl.textContent = message;
    }

    function hideError() {
      errorEl.style.display = "none";
      errorEl.textContent = "";
    }

    function renderTable(rows) {
      if (!rows || rows.length === 0) {
        tableContainer.innerHTML = "<p>No rows found in <code>database</code> table.</p>";
        return;
      }

      const columns = Object.keys(rows[0]);
      let html = "<table><thead><tr>";

      for (const col of columns) {
        html += `<th>${col}</th>`;
      }
      html += "</tr></thead><tbody>";

      for (const row of rows) {
        html += "<tr>";
        for (const col of columns) {
          const val = row[col];
          html += `<td>${val === null || val === undefined ? "" : String(val)}</td>`;
        }
        html += "</tr>";
      }

      html += "</tbody></table>";
      tableContainer.innerHTML = html;
    }

    async function loadData() {
      setStatus(null, "Connecting…");
      hideError();
      loadingEl.style.display = "block";

      try {
        const { data, error } = await client
          .from(TABLE_NAME)
          .select("*");

        if (error) {
          setStatus("error", "Connection failed");
          showError(error.message || "Unknown error");
          loadingEl.style.display = "none";
          return;
        }

        setStatus("connected", "Connected to Supabase!");
        renderTable(data);
      } catch (err) {
        console.error(err);
        setStatus("error", "Connection error");
        showError(err.message || String(err));
      } finally {
        loadingEl.style.display = "none";
      }
    }

    // Run when page loads
    window.addEventListener("DOMContentLoaded", loadData);
  </script>
</body>
</html>
