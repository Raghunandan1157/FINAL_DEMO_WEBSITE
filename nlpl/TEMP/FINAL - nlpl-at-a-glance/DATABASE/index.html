<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PAR Report Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      background: #0f172a;
      color: #e5e7eb;
    }
    h1 {
      margin-top: 0;
    }
    #status {
      margin: 8px 0 16px;
      font-size: 14px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 12px;
      background: #020617;
    }
    th, td {
      border: 1px solid #1f2937;
      padding: 4px 6px;
      text-align: left;
      white-space: nowrap;
    }
    th {
      position: sticky;
      top: 0;
      background: #111827;
      z-index: 1;
    }
    tbody tr:nth-child(even) {
      background: #030712;
    }
    .table-wrapper {
      max-height: 80vh;
      overflow: auto;
      border: 1px solid #1f2937;
      border-radius: 6px;
    }
    button {
      background: #22c55e;
      color: #0f172a;
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 13px;
      cursor: pointer;
      font-weight: 500;
    }
    button:hover {
      opacity: 0.9;
    }
    .controls {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }
    input[type="file"] {
      font-size: 13px;
    }
  </style>
</head>
<body>
  <h1>PAR Report — CSV Viewer</h1>

  <p>
    Select any <strong>.csv</strong> file and this page will parse & display it.<br>
    No need to edit the script or file name.
  </p>

  <div class="controls">
    <input type="file" id="fileInput" accept=".csv" />
    <button id="reloadBtn">Reload Last CSV</button>
  </div>

  <div id="status">Choose a CSV file to begin…</div>

  <div class="table-wrapper">
    <table id="csvTable">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const statusEl = document.getElementById("status");
    const tableHead = document.querySelector("#csvTable thead");
    const tableBody = document.querySelector("#csvTable tbody");
    const reloadBtn = document.getElementById("reloadBtn");
    const fileInput = document.getElementById("fileInput");

    // Keep the last chosen file in memory so "Reload" works
    let lastFile = null;

    function setStatus(msg) {
      statusEl.textContent = msg;
    }

    fileInput.addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (!file) return;
      if (!file.name.toLowerCase().endsWith(".csv")) {
        setStatus("Please select a .csv file.");
        return;
      }
      lastFile = file;
      loadCsvFromFile(file);
    });

    reloadBtn.addEventListener("click", () => {
      if (!lastFile) {
        setStatus("No previous CSV loaded. Please choose a file first.");
        return;
      }
      loadCsvFromFile(lastFile);
    });

    function loadCsvFromFile(file) {
      setStatus("Reading: " + file.name + " …");
      tableHead.innerHTML = "";
      tableBody.innerHTML = "";

      const reader = new FileReader();

      reader.onload = () => {
        try {
          const text = reader.result;
          const rows = parseCsv(text);

          if (!rows.length) {
            setStatus("CSV is empty or could not be parsed.");
            return;
          }

          renderTable(rows);
          setStatus(`Loaded ${rows.length - 1} rows from "${file.name}".`);
        } catch (err) {
          console.error(err);
          setStatus("Error parsing CSV: " + err.message);
        }
      };

      reader.onerror = () => {
        console.error(reader.error);
        setStatus("Error reading file: " + (reader.error?.message || "Unknown error"));
      };

      reader.readAsText(file);
    }

    function renderTable(rows) {
      // Header
      const headerRow = rows[0];
      const theadTr = document.createElement("tr");
      headerRow.forEach(col => {
        const th = document.createElement("th");
        th.textContent = col;
        theadTr.appendChild(th);
      });
      tableHead.appendChild(theadTr);

      // Data
      for (let i = 1; i < rows.length; i++) {
        const tr = document.createElement("tr");
        rows[i].forEach(cell => {
          const td = document.createElement("td");
          td.textContent = cell;
          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
      }
    }

    // Very simple CSV parser (no complex quotes support).
    function parseCsv(text) {
      // Normalize newlines and split into lines
      const lines = text
        .replace(/\r\n/g, "\n")
        .replace(/\r/g, "\n")
        .split("\n");

      const rows = [];

      for (const line of lines) {
        if (!line.trim()) continue; // skip empty
        // Split by comma. If your data has commas inside cells,
        // consider using a proper CSV parser library instead.
        const cols = line.split(",").map(c => c.trim());
        rows.push(cols);
      }
      return rows;
    }

    // Optional: you could auto-open the file picker on load (commented out)
    // window.addEventListener("load", () => fileInput.click());
  </script>
</body>
</html>
