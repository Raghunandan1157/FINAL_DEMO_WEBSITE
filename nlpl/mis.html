<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MIS ‚Äì File Selector</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #ffffff; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-white px-4 py-8">

  <!-- Centered Card -->
  <div class="w-full max-w-4xl">
    <div class="rounded-2xl border border-gray-200 shadow-lg bg-white overflow-hidden">
      <!-- Header -->
      <div class="px-6 pt-5 pb-4 border-b border-gray-100 bg-gradient-to-r from-slate-50 to-slate-100">
        <h1 class="text-2xl font-semibold text-gray-900">
          MIS ‚Äì Select a File
        </h1>
        <p class="mt-1 text-sm text-gray-500">
          Click any file below to open its MIS view, or search by name.
        </p>

        <!-- Search Bar -->
        <div class="mt-4 flex justify-end">
          <div class="relative w-full sm:w-72">
            <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-gray-400 text-sm">
              üîç
            </span>
            <input
              id="searchInput"
              type="text"
              placeholder="Search files..."
              class="w-full rounded-full border border-gray-300 bg-white pl-9 pr-3 py-1.5 text-sm text-gray-900
                     placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:border-slate-400"
            />
          </div>
        </div>
      </div>

      <!-- File Grid -->
      <div class="p-6">
        <div id="fileContainer" 
             class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
          <!-- JS will fill this -->
        </div>
      </div>
    </div>
  </div>

  <script>
    const container = document.getElementById("fileContainer");
    const searchInput = document.getElementById("searchInput");

    let allFiles = []; // full list loaded from files.json

    function renderFiles(list) {
      container.innerHTML = "";

      if (!list.length) {
        container.innerHTML = `
          <div class="text-gray-500 text-center col-span-full text-sm">
            No files match your search.
          </div>
        `;
        return;
      }

      list.forEach(file => {
        const box = document.createElement("div");

        box.className =
          "group relative flex flex-col gap-2 border border-gray-200 bg-white " +
          "rounded-xl px-4 py-3 shadow-sm cursor-pointer transition " +
          "hover:shadow-md hover:-translate-y-0.5 hover:border-slate-300";

        box.innerHTML = `
          <div class="flex items-start gap-2">
            <div class="mt-0.5 h-8 w-8 flex items-center justify-center rounded-lg bg-slate-100">
              <span class="text-sm font-semibold text-slate-600">MIS</span>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-gray-900 break-words">
                ${file}
              </p>
              <p class="mt-1 text-xs text-gray-500">
                HTML report file
              </p>
            </div>
          </div>
          <div class="mt-2 flex items-center justify-between text-[11px] text-gray-400">
            <span>Click to open</span>
            <span class="inline-flex items-center gap-1">
              <span>Open</span>
              <span class="transition-transform group-hover:translate-x-0.5">‚Üí</span>
            </span>
          </div>
        `;

        box.onclick = () => {
          window.location.href = "MIS/" + file;
        };

        container.appendChild(box);
      });
    }

    async function loadMisFiles() {
      try {
        // Prevent aggressive caching by adding a timestamp
        const res = await fetch("MIS/files.json?_=" + Date.now());

        if (!res.ok) {
          throw new Error("Unable to load MIS/files.json");
        }

        const json = await res.json();
        let files = json.files || [];

        // Optional: keep only .html files
        files = files.filter(f => f.toLowerCase().endsWith(".html"));

        if (!files.length) {
          container.innerHTML = `
            <div class="text-gray-500 text-center col-span-full text-sm">
              No MIS HTML files listed in files.json
            </div>
          `;
          return;
        }

        allFiles = files;
        renderFiles(allFiles);
      } catch (err) {
        console.error(err);
        container.innerHTML = `
          <div class="text-red-500 text-center col-span-full text-sm">
            Could not load MIS file list (MIS/files.json missing?)
          </div>
        `;
      }
    }

    // Live search
    if (searchInput) {
      searchInput.addEventListener("input", (e) => {
        const q = e.target.value.toLowerCase();
        const filtered = allFiles.filter(f => f.toLowerCase().includes(q));
        renderFiles(filtered);
      });
    }

    loadMisFiles();
  </script>

</body>
</html>
