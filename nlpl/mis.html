<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NLPL — MIS Snapshot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:#f4f6fb;color:#0f172a;}
    .card{background:#fff;border:1px solid rgba(15,23,42,.08);border-radius:18px;box-shadow:0 16px 45px rgba(15,23,42,.07);}
    @media (max-width: 640px){
      main > header{flex-direction:column;align-items:flex-start;gap:1rem;}
      main > header .flex{width:100%;justify-content:flex-start;flex-wrap:wrap;gap:.5rem;}
      main > header .flex button{flex:1;}
      .card{padding:1.5rem;}
      #mis-table{font-size:0.75rem;}
    }
    @media (max-width: 480px){
      main{padding-inline:1rem;}
      #mis-table td, #mis-table th{padding:.5rem;}
    }
  </style>
</head>
<body class="min-h-screen">
  <main class="max-w-6xl mx-auto px-4 py-8 space-y-8">
    <header class="card p-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <p class="text-xs tracking-wide text-indigo-600 font-semibold uppercase">Corporate MIS</p>
        <h1 class="text-2xl font-semibold">Branch Intelligence</h1>
        <p class="text-sm text-slate-500" id="branch-label">For CORPORATE OFFICE (CO)</p>
      </div>
      <div class="flex gap-2 flex-wrap">
        <button data-range="7" class="px-3 py-1.5 rounded-full border border-slate-200 text-sm font-semibold text-slate-600 active-range">Last 7 days</button>
        <button data-range="30" class="px-3 py-1.5 rounded-full border border-slate-200 text-sm text-slate-600">30 days</button>
        <button data-range="90" class="px-3 py-1.5 rounded-full border border-slate-200 text-sm text-slate-600">Quarter</button>
      </div>
    </header>

    <section class="grid gap-5 md:grid-cols-2 xl:grid-cols-4" id="kpi-grid"></section>

    <section class="card p-6">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h2 class="text-lg font-semibold">Drill down</h2>
          <p class="text-sm text-slate-500">Mock data — replace with live MIS feed.</p>
        </div>
        <input id="search" type="search" placeholder="Search metric…" class="px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-200 focus:border-indigo-300" />
      </div>
      <div class="mt-4 overflow-auto">
        <table class="min-w-full text-sm" id="mis-table">
          <thead class="bg-slate-50 text-slate-500 uppercase text-xs">
            <tr>
              <th class="text-left p-3">Metric</th>
              <th class="text-right p-3">Value</th>
              <th class="text-right p-3">Target</th>
              <th class="text-right p-3">Variance</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100 text-slate-700"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    (function(){
      const payload = (()=> {
        const raw = localStorage.getItem('nlpl_profile_payload');
        if(!raw) return null;
        try{ return JSON.parse(raw); }catch(_){ return null; }
      })();
      const branchLabel = document.getElementById('branch-label');
      if(payload){
        const branch = payload.branch?.name || payload.profile?.["Branch Name"] || 'CORPORATE OFFICE';
        branchLabel.textContent = `For ${branch} (${payload.branch?.code || payload.profile?.["Branch Code"] || 'CO'})`;
      }

      const baseData = [
        { metric:'Disbursement', value: 128.6, target: 140, unit:'Cr', category:'Growth' },
        { metric:'Collection Efficiency', value: 96.2, target: 98, unit:'%', category:'Collections' },
        { metric:'1+ PAR', value: 4.8, target: 4.5, unit:'%', category:'Risk' },
        { metric:'NPA', value: 2.1, target: 2.0, unit:'%', category:'Risk' },
        { metric:'FTOD Recovery', value: 87.3, target: 85, unit:'%', category:'Collections' },
        { metric:'Branches Audited', value: 8, target: 8, unit:'Nos', category:'Governance' },
        { metric:'New Centers Added', value: 34, target: 30, unit:'Nos', category:'Growth' },
        { metric:'Customer Base', value: 18500, target: 19000, unit:'Nos', category:'Scale' }
      ];

      const kpiGrid = document.getElementById('kpi-grid');
      const ranges = {7:1.01, 30:1.0, 90:0.98};
      let currentRange = 7;

      function fmt(val, unit){
        if(unit === '%') return val.toFixed(1) + unit;
        if(val >= 1000 && unit === 'Nos') return (val/1000).toFixed(1) + 'k';
        return unit === 'Cr' ? val.toFixed(1) + ' Cr' : val.toString() + ' ' + unit;
      }

      function renderKPIs(){
        const factor = ranges[currentRange] || 1;
        kpiGrid.innerHTML = baseData.slice(0,4).map(item=>{
          const adj = item.value * factor;
          const delta = ((adj - item.target) / Math.max(item.target, 0.001)) * 100;
          const deltaColor = delta >= 0 ? 'text-emerald-600' : 'text-rose-600';
          const deltaSign = delta >= 0 ? '+' : '';
          return `
            <div class="card p-5 flex flex-col gap-2">
              <p class="text-xs tracking-wide uppercase text-slate-500">${item.metric}</p>
              <p class="text-3xl font-semibold">${fmt(adj, item.unit)}</p>
              <p class="text-xs ${deltaColor}">${deltaSign}${delta.toFixed(1)}% vs target</p>
            </div>
          `;
        }).join('');
      }

      function renderTable(filter=''){
        const tbody = document.querySelector('#mis-table tbody');
        const rows = baseData.filter(item => item.metric.toLowerCase().includes(filter.toLowerCase()));
        tbody.innerHTML = rows.map(item=>{
          const variance = item.value - item.target;
          const varianceClass = variance >= 0 ? 'text-emerald-600' : 'text-rose-600';
          const formatted = variance >= 0 ? '+' + variance.toFixed(1) : variance.toFixed(1);
          return `
            <tr>
              <td class="p-3 font-semibold">${item.metric}</td>
              <td class="p-3 text-right">${fmt(item.value, item.unit)}</td>
              <td class="p-3 text-right text-slate-500">${fmt(item.target, item.unit)}</td>
              <td class="p-3 text-right ${varianceClass}">${formatted}</td>
            </tr>
          `;
        }).join('');
      }

      document.querySelectorAll('[data-range]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          document.querySelectorAll('[data-range]').forEach(b=> b.classList.remove('active-range','bg-indigo-600','text-white'));
          btn.classList.add('active-range','bg-indigo-600','text-white');
          currentRange = Number(btn.dataset.range);
          renderKPIs();
        });
      });

      document.getElementById('search').addEventListener('input', (e)=>{
        renderTable(e.target.value || '');
      });

      renderKPIs();
      renderTable();
    })();
  </script>
</body>
</html>
